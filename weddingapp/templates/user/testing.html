{% extends 'user/layout1.html'%}
{% block title%} {{session['user']}} {% endblock %}

{% block statement %}
    <p class="display-4 color1">Welcome, {{session['user']}} </p>
    <p class="lead color2">
        We would like to hear from you. Please fill the form let us know your thoughts..
    </p>
    {% set msg = get_flashed_messages(with_categories=True)%}
    {% if msg %}
    {% for i in msg %}
    {% if i[0] == 'error'%}
    <p class="alert alert-danger">{{i[1]}}</p>
    {% else %}
    <p class="alert alert-success">{{i[1]}}</p>
    {% endif %}
    {% endfor %}
    {% endif %}
    <div class="bg-dark col-7 p-3">
        {% include "user/nav.html" %}
        
    </div>
    <div class="d-flex btn-group">
        <a href="/logout" class="btn btn-lg color3 d-inline-block" style="border:2px solid #BA68C8;">Log out</a>
    </div>
{% endblock %}

{% block form %}


<!-- <h1>TESTING SERIALIZE METHOD</h1>
<form action="" method="post" enctype="multipart/form-data" id="myform">
    <input type="file" id="image"  name="image"class=" form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;"><br>
    <input type="text"  name="firstname" class=" form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;"><br>
    <input type="text"  name="lastname" class=" form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;"><br>
    <input type="text"  name="email" class=" form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;"><br>
    <input type="text"  name="phone"class=" form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;"><br>
    <button type="button" class="btn btn-lg color3 d-inline-block" style="border:2px solid #BA68C8;" id="btnserial"> Button me</button><br>
    
</form> -->



            <!-- THE STATE DROPDOWN     -->
            <br>
        <select id="mystate" name="mystate" class="form-control" style="background-color:rgba(0, 0,0, 0.7);border: 1px solid #BA68C8; color: #BA68C8;">
            <option>--select you State of Origin--</option>
            {% for i in states %}
        </option>
            <option id="opt" value="{{ i.state_id}}">
              {{ i.state_name}}
              </option>
              {% endfor %} 
        </select>
        <br>

        <!-- THE LGA SELECT -->
    

    <select name="mylga" id="mylga" class="form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;">
        <option>--please the lga--</option>
      
    </select>

    <h1> TESTING PICTURE</h1>
    <form action="" id="myform" method="post" enctype="multipart/form-data">
        
        <img src="{{ url_for('static',filename='images/wedding2.jpg')}}" width="120" id="profile" alt="pics">
    
        <input type="file" name="image" class=" form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;"><br>
        <input type="text" name="firstname" class=" form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;"><br>
        <input type="text" name="lastname" class=" form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;"><br>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="button" class="btn btn-lg color3 d-inline-block" style="border:2px solid #BA68C8;" id="btnserial"> Button me</button><br>
        
    </form>


<div class="p-3 mt-5">

    <form action="/ajaxtest/checkusername" method="get">
        <div class="mb-3 row">
            <p id="feedback"></p>
            <p class="lead color1">USERNAME</p>
<input type="text" name="username" id="username" class="form-select form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;" >
</div>

<div class="mb-3 row">
    <p class="lead color1">PASSWORD</p>
<input type="password" name="email" id="email" class="form-select form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;" >
</div>

        <div class="d-flex btn-group">
            <button class="btn btn-lg color3 d-inline-block" style="border:2px solid #BA68C8;">Submit Me</button>
        </div>
    </form>
    <!-- <form action="/user/update" method="post">
        <div class="mb-3 row">
            <p class="lead color1">Please select your gift</p>

            <label>First Name</label>
            <input type="text">
            <select name="case" id="caseid" class="form-select form-control" style="background-color:rgba(0, 0,0, 0.9);border: 1px solid #BA68C8; color: #BA68C8;">
                <option value="">Please select a subject</option>
                
            </select>
        </div>
        <div class="d-flex btn-group">
            <button class="btn btn-lg color3 d-inline-block" style="border:2px solid #BA68C8;">Submit</button>
        </div>
    </form>
</div> -->

<script type="text/javascript">
    $(document).ready(function(){

        $('#btnserial').click(function(){
            // var datas = $('#myform').serialize()
            var form = document.getElementById('myform')  //$('#myform')[0]
            var datas = new FormData(form)
            datas.append('missing',"I am not part of the actual form activity")

                // SERIALIZE TYPE
            $.ajax({
                url:'/ajaxtests/final',
                data:datas,
                type:'post',
                dataType:'json',

                cache:false,
                processData:false,
                contentType:false,



                success:function(rsp){
                    // console.log(rsp)
                    // alert(rsp.age, rsp.score)
                    // alert(rsp['summary']) // 2nd method
                    imglocation = '../static/images/' + rsp.filename
                    $('#profile').attr('src', imagelocation)
                },
                error:function(error){
                    console.log(error)
                }
            })
        })

            // AJAX DROPDOWN
            $('#mystate').change(function(){
                var state = $(this).val()
                var datasent = {'stateid':state}
                $.ajax({
                    url:'/ajaxtests/state',
                    data:datasent,
                    type:'get',
                    dataType:'text',
                    success:function(rsp){
                        $('#mylga').html(rsp)
                    },
                    error:function(errormsg){
                        console.log(errormsg)
                    }

                })
            })








        $('#username').change(function(){
            var data2send = {'username':$(this).val()}
            //alert($(this).val())
            $.ajax({
                url:'/ajaxtest/checkusername',
                data:data2send,
                type:'get',
                dataType:'text',
                beforeSend:function(){},
                success:function(rsp){
                    //alert(rsp)
                    $('#feedback').html(rsp)
                },
                error:function(msg){
                    console.log(msg)
                }
            })
        })
    })             
    
</script>
{% endblock%}